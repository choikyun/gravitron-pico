# GRAVITRON for Raspberry Pi Pico

2年ぶりにRaspberry Pi Pico と [Pico用 1.14インチ 液晶モジュール](https://www.waveshare.com/pico-lcd-1.14.htm) の組み合わせでゲームを作ってみました。  
MicroPythonで動作します。  

![スクリーンショット1](/images/screenshot0_480.png)  

[YouTube プレイ動画](https://youtu.be/d3WHsKkQOzY)  

疑似3D表示のレースゲームです。

***

## 実行方法

MicroPython 上で動作します。  
Thonny でinstallフォルダの全てのファイルを Pico に転送してください。  
その後 Thonny から main.py を実行するか、何か電源（モバイルバッテリーなど）に繋ぎ直してください。  
（main.py が自動実行されます）  

動作確認は無印のPicoと[Pico用 1.14インチ 液晶モジュール](https://www.waveshare.com/pico-lcd-1.14.htm)でしています。  
MicroPython 1.23.0 で確認しています。  

Pico W とPico2では動作確認していません。  

もし何らかのエラーが発生する場合はお手数ですが、エラーメッセージなどの詳細を添えてご連絡ください。  


***


## 操作方法

*タイトル*  
 [LEFT] [RIGHT] コース選択  
 [UP][DOWN] 液晶の輝度  
 [A] EXモード切り替え  
 [B] ゲームスタート  

*ゲーム中*  
 [LEFT] [RIGHT] ステアリング  
 [A] ポーズ  
 [B] アクセル  

*ポーズ中*  
 [A] タイトルへ戻る（リタイア）  
 [B] ゲームへ戻る  


***

## 遊び方

![スクリーンショット1](/images/screenshot1_480.png)  

普通のレースゲームです。  
コースを3周するとクリアです。  

ピンク色のゴールラインを超えるとラップタイムの計測が始まります。  
（自分のタイミングでスタートできます）  

画面の一番上の緑のバーはエネルギーです。  
エネルギーが切れると何故か爆発してゲームオーバーになります。  
コースアウトするとガクンと減ってしまうので注意してください。  

エネルギーは走行中も減っていきますが、コースの緑色の部分を走ると回復します。  
1周すると半分回復します。  

黄色のバーを踏むと一定時間加速します。（その分エネルギーを消費します）  
テンポよく踏んでいけばずっと加速したままでいられます。  

レース場は巨大惑星周辺にあるので、重力が発生しています。  
コースの丸い部分が重力源です。ある程度近づくと引っ張られてしまいます。  
加速中はあまり影響を受けないので、速度を落とさないようにしましょう。  

ラップタイムの表示は1周するまで更新されません。（手抜き）  
3周するとリザルト画面になり、合計のタイムが表示されます。  
Bボタンを押すとタイトルに戻ります。  

ゲーム中Aボタンを押すとポーズになります。  
ポーズ中にAボタンを押すとリタイアになり、タイトル画面に戻ります。  

***

## 技術的な事

### 疑似3D

2Dのマップを拡大・縮小・回転して、3Dっぽく見せています。
ふたつあるコアのひとつを描画と座標変換に使っています。  

また動作クロックを250MHzに上げています。  
僕の pico だと特に問題なく動いていますが、動かない個体があるかもしれません。  

ヒープメモリの確保の仕方とか、もっと工夫できると思うのですが、とりあえず動いているのでヨシとしています。  

### tools フォルダ

今回のゲーム用のデータをつくるツールです。  

*png_to_course_data.py*  
 courseフォルダ内の64*32ピクセルの画像（24bit png）をコースデータに変換します。  

*png_to_dat.py ［フォルダ］*  
 フォルダ内のスプライト用の画像（24bit png）をひとつにまとめます。  

"png_to_dat.py main" とすればmainフォルダ内の画像をひとつのファイルにします。  
ファイルは out フォルダに出力します。  
画像処理ライブラリPillow(PIL)が必要です。  

***

## 資料等

[Raspberry Pi Pico](https://www.raspberrypi.com/products/raspberry-pi-pico/)

[1.14inch LCD Display Module for Raspberry Pi Pico, 65K Colors, 240×135, SPI](https://www.waveshare.com/pico-lcd-1.14.htm)

[Pocekt Game Library](https://pocketgame.ddns.net)