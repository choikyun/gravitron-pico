# GRAVITRON for Raspberry Pi Pico

2年ぶりにRaspberry Pi Pico と [Pico用 1.14インチ 液晶モジュール](https://www.waveshare.com/pico-lcd-1.14.htm) の組み合わせでゲームを作ってみました。  
MicroPythonで動作します。  

![スクリーンショット1](/images/screenshot0_480.png)  

[YouTube プレイ動画](https://youtu.be/d3WHsKkQOzY)  

疑似3D表示のレースゲームです。

***

## 実行方法

MicroPython 上で動作します。  
Thonny でinstallフォルダの全てのファイルを Pico に転送してください。  
その後 Thonny から main.py を実行するか、何か電源（モバイルバッテリーなど）に繋ぎ直してください。  
（main.py が自動実行されます）  

動作確認は無印のPicoと[Pico用 1.14インチ 液晶モジュール](https://www.waveshare.com/pico-lcd-1.14.htm)でしています。
python は MicroPython 1.23.0 で確認しています。  

Pico W とPico2では確認していません。  

もし何らかのエラーが発生する場合はお手数ですが、エラーメッセージなどの詳細を添えてkyun34@gmail.comまでご連絡ください。  


***

## 遊び方

タイトル画面でコースを選択できます。  
コースは3つあります。  
Bボタンでゲーム開始となります。  


ジョイスティックの左右がハンドル、Bボタンがアクセルです。  

![スクリーンショット1](/images/screenshot1_480.png)  

ピンクのゴールラインを超えるとラップタイムの計測が始まります。  
自分のタイミングでスタートできます。  

3周するとクリアです。  

画面の一番上の緑のバーはエネルギーです。  
エネルギーが切れると何故か爆発してゲームオーバーになります。  
コースアウトするとガクンと減ってしまうので注意してください。  

エネルギーは走行中も減っていきますが、コースの緑色の部分を走っていると回復します。  


コース中の黄色のバーを踏むと一定時間加速します。（その分エネルギーを消費します）  
テンポよく踏んでいけばずっと加速したままでいられます。  


レース場は巨大惑星周辺にある（という設定）ので、重力が発生しています。  
コースの丸い部分が重力源です。ある程度近づくと引っ張られてしまいます。  
加速中はあまり影響を受けないので、止まらないようにしましょう。  


ラップタイムは1周するまで更新されません。（手抜き）  
無事3周するとリザルト画面になり、合計のタイムが表示されます。  
リザルト画面でBボタンを押すとタイトルに戻ります。

***

## 技術的な事

### 疑似3Dについて

昔、Palm Pilot でマリオカートもどきを作ってみた事があるのですが、それと同じような仕組みです。  
2Dのマップを拡大・縮小・回転して、3Dっぽく見せています。（スーファミのマリオカート、F-ZEROみたいな感じ）

メモリや速度の制約があるので、いろいろ工夫しています。  
とくに描画は重たいので、もうひとつのコアを描画専用に使っています。  
それでも画面の更新は遅いです。30フレーム出ていません。  

Pico2ならもう少し楽になるのでしょうか…。

また、クロックを上げているので（250MHzにしている 300は動かなかった）もしかしたら動かない人がいるかもしれません。  
僕の pico だと特に問題なく動いています。  

ヒープメモリの確保の仕方とか、もっともっと工夫できると思うのですが、とりあえず動いているのでヨシとしています。  

### tools フォルダ

今回のゲーム用のデータをつくるツールです。  
改造（改良）する時に使ってください。  

*png_to_course_data.py* は64*32ピクセルのpng画像（24bitカラー）をコースデータに変換します。  

*png_to_dat.py* はフォルダのpng画像（24bitカラー）にひとつにまとめます。  

"png_to_dat.py main" とすればmainフォルダをひとつのファイルにまとめます。  
ファイルは out フォルダに出力します。  
どちらのツールも画像処理ライブラリPillow(PIL)が必要です。pipでインストールしてください。  

***

## 資料等

[Raspberry Pi Pico](https://www.raspberrypi.com/products/raspberry-pi-pico/)

[1.14inch LCD Display Module for Raspberry Pi Pico, 65K Colors, 240×135, SPI](https://www.waveshare.com/pico-lcd-1.14.htm)

[Pocekt Game Library](https://pocketgame.ddns.net)